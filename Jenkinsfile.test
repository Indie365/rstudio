pipeline {
  agent {
    dockerfile {
      filename 'Dockerfile.dispatcher'
      label 'linux && amd64'
    }
  }

  parameters {
    gitParameter defaultValue: "${env.BRANCH_NAME}",
                 name: 'COMMIT_HASH',
                 type: 'PT_REVISION'
  }


  stages {
    stage ("Checkout") {
      steps {
        echo "Commit_hash value: ${params.COMMIT_HASH}"
        checkout([$class: 'GitSCM',
                  branches: [[name: '${params.COMMIT_HASH}']],
                  extensions: [],
                  userRemoteConfigs: [[credentialsId: 'github-rstudio-jenkins', url: 'https://github.com/rstudio/rstudio']]])
        script {
          def value = readFile('TEST')
          echo "File contents: ${value}"
        }

      }
    }
  }
}